<!--
    Copyright 2014 Ed Carter

    This file is part of Deadbolt Password Generator.

    Deadbolt Password Generator is free software: you can redistribute
    it and/or modify it under the terms of the GNU General Public
    License as published by the Free Software Foundation, either
    version 3 of the License, or (at your option) any later version.

    Deadbolt Password Generator is distributed in the hope that it
    will be useful, but WITHOUT ANY WARRANTY; without even the implied
    warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
    See the GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Deadbolt Password Generator.  If not, see
    <http://www.gnu.org/licenses/>.
 -->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog-transition.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../deadbolt-password-generator/deadbolt-password-generator.html">
<link rel="import" href="../password-breakdown/password-breakdown.html">

<polymer-element name="password-reveal" attributes="passPhrase includeSymbols caseSensitive passwordLength pinNumber">
    <template>
        <link href="password-reveal.css" rel="stylesheet" />
        <div style="visibility: {{ passPhrase.length >= 6 ? 'visible' : 'hidden'}};">
            
            <paper-button raisedbutton class="colored" on-click="{{click}}">Generate</paper-button>
            <paper-dialog id="passwordDialog" backdrop="true" autoCloseDisabled="true" >
                <div id="fullPassword">{{password}}</div>
                <div>
                    <password-breakdown password="{{password}}"></password-breakdown>
                </div>
                <div id="action-buttons">
                    <paper-button raisedbutton class="colored" on-click="{{copyPassword}}">Copy</paper-button>
                    <paper-button raisedbutton class="colored" on-click="{{closeDialog}}">Close</paper-button>
                </div>
            </paper-dialog>
        </div>

        <!--<paper-toast id="copiedToClipboardToast" text="Password copied to clipboard"></paper-toast>-->

    </template>
    <script>
        Polymer('password-reveal', {
            includeSymbols: true,
            caseSensitive: true,
            passwordLength: 15,
            pinNumber: '0000',
            passPhrase: '',
            password: '',
            click: function () {
                this.password = deadboltPasswordGenerator.generatePassword(this.passPhrase, this.pinNumber, this.includeSymbols, this.caseSensitive, this.passwordLength);
                console.log(this.password);
                var dialog = this.$.passwordDialog;
                dialog.toggle();
            },
            closeDialog: function() {
                var dialog = this.$.passwordDialog;
                this.password = '';
                this.passPhrase = '';
                dialog.toggle();
            },
            copyPassword: function () {
                cordova.plugins.clipboard.copy(this.password);
                this.$.copiedToClipboardToast.show();
            }
        });
    </script>
</polymer-element>